<!DOCTYPE html>
<html>
<head>
    <title>Rubik's Cube State Checker</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { margin-bottom: 10px; }
        .controls { margin-bottom: 20px; }
        .controls input { width: 400px; padding: 5px; font-size: 14px; }
        .controls button { padding: 5px 10px; font-size: 14px; margin-left: 5px; cursor: pointer; }

        #cube { display: flex; gap: 30px; margin-bottom: 20px; }
        .face-container { display: flex; flex-direction: column; align-items: center; }
        .face-container h3 { margin-bottom: 5px; }

        .face { display: grid; grid-template-columns: repeat(3, 40px); grid-gap: 3px; }
        .tile { width: 40px; height: 40px; border: 1px solid #444; text-align: center; line-height: 40px; font-size: 14px; border-radius: 4px; cursor: pointer; }

        /* Colors */
        .color-U { background: white; }
        .color-R { background: red; }
        .color-F { background: green; }
        .color-D { background: yellow; }
        .color-L { background: orange; }
        .color-B { background: blue; }
        .color-_ { background: #ccc; }

        pre { background: #f0f0f0; padding: 15px; border-radius: 5px; max-width: 1000px; overflow-x: auto; }
    </style>
</head>
<body>

<h1>Rubik's Cube State Checker</h1>

<div class="controls">
    <input
        id="stateInput"
        type="text"
        value="WWWWWWWWWOOOOOOOOOGGGGGGGGGRRRRRRRRRBBBBBBBBBYYYYYYYYY"
        placeholder="Enter 54-character cube state"
    >
    <button onclick="loadState()">Set State</button>
    <button onclick="checkCube()">Check Cube</button>
    <button onclick="resetCube()">Reset</button>
    <button onclick="randomState()">Random State</button>
</div>

<div id="cube">
    <div class="face-container">
        <h3>U</h3>
        <div class="face" id="U"></div>
    </div>
    <div class="face-container">
        <h3>R</h3>
        <div class="face" id="R"></div>
    </div>
    <div class="face-container">
        <h3>F</h3>
        <div class="face" id="F"></div>
    </div>
    <div class="face-container">
        <h3>D</h3>
        <div class="face" id="D"></div>
    </div>
    <div class="face-container">
        <h3>L</h3>
        <div class="face" id="L"></div>
    </div>
    <div class="face-container">
        <h3>B</h3>
        <div class="face" id="B"></div>
    </div>
</div>

<h3>Moves</h3>
<div id="moves" style="margin-bottom:20px;">
    <button onclick="sendMove('U')">U</button>
    <button onclick="sendMove(`U'`)">U'</button>
    <button onclick="sendMove('U2')">U2</button>

    <button onclick="sendMove('R')">R</button>
    <button onclick="sendMove(`R'`)">R'</button>
    <button onclick="sendMove('R2')">R2</button>

    <button onclick="sendMove('F')">F</button>
    <button onclick="sendMove(`F'`)">F'</button>
    <button onclick="sendMove('F2')">F2</button>

    <button onclick="sendMove('D')">D</button>
    <button onclick="sendMove(`D'`)">D'</button>
    <button onclick="sendMove('D2')">D2</button>

    <button onclick="sendMove('L')">L</button>
    <button onclick="sendMove(`L'`)">L'</button>
    <button onclick="sendMove('L2')">L2</button>

    <button onclick="sendMove('B')">B</button>
    <button onclick="sendMove(`B'`)">B'</button>
    <button onclick="sendMove('B2')">B2</button>
</div>

<h3>Move History:</h3>
<pre id="move-history"></pre>
<h3>Output:</h3>
<pre id="solution-output"></pre>
<pre id="output"></pre>

<script>

const colorClass = {
    "W": "color-U",
    "R": "color-R",
    "G": "color-F",
    "Y": "color-D",
    "O": "color-L",
    "B": "color-B",
    "_": "color-_"
};

const colors = ["U", "R", "F", "D", "L", "B", "_"];  // order to cycle through
const faceOrder = ["U", "R", "F", "D", "L", "B"];
const tilesPerFace = 9;
const defaultState = "WWWWWWWWWOOOOOOOOOGGGGGGGGGRRRRRRRRRBBBBBBBBBYYYYYYYYY";

let history = []; 

// Generate tiles for each face
for (let face of faceOrder) {
    const faceDiv = document.getElementById(face);
    for (let i = 0; i < tilesPerFace; i++) {
        const tile = document.createElement("div");
        tile.classList.add("tile");
        tile.dataset.pos = i;
        tile.dataset.face = face;

        // click to cycle color
        tile.addEventListener("click", () => {
            let current = colors.indexOf(tile.dataset.color || "_");
            current = (current + 1) % colors.length;
            tile.dataset.color = colors[current];
            tile.className = "tile " + colorClass[colors[current]];
            updateInputFromTiles();
            // clear history when tiles are manually changed
            history = []; 
            updateMoveHistoryDisplay(); 
        });

        faceDiv.appendChild(tile);
    }
}

function updateMoveHistoryDisplay() {
    // add forward slash for every 10 moves
    let formattedHistory = "";
    for (let i = 0; i < history.length; i++) {
        formattedHistory += history[i] + " ";
        if ((i + 1) % 10 === 0) {
            formattedHistory += "/ ";
        }
    }
    document.getElementById("move-history").textContent = formattedHistory.trim();
}

// Apply cube state string to tiles
function applyCubeState(state) {
    if(state.length !== 54) {
        alert("State must be 54 characters!");
        return;
    }
    let index = 0;
    for(let face of faceOrder) {
        const tiles = document.querySelectorAll(`#${face} .tile`);
        tiles.forEach(tile => {
            const char = state[index];
            tile.dataset.color = char;
            tile.className = "tile " + (colorClass[char] || "color-_");
            index++;
        });
    }
}

// Update input field based on current tile colors
function updateInputFromTiles() {
    let state = "";
    for (let face of faceOrder) {
        const tiles = document.querySelectorAll(`#${face} .tile`);
        tiles.forEach(tile => {
            state += tile.dataset.color || "_";
        });
    }
    document.getElementById("stateInput").value = state;
}

function loadState() {
    const state = document.getElementById("stateInput").value.trim().toUpperCase();
    applyCubeState(state);
    // clear history when a new state is loaded from the input box
    history = []; 
    updateMoveHistoryDisplay();
}

function resetCube() {
    applyCubeState(defaultState);
    document.getElementById("stateInput").value = defaultState;
    // clear history on reset
    history = []; 
    updateMoveHistoryDisplay();
}

function checkCube() {
    const state = document.getElementById("stateInput").value.trim().toUpperCase();
    if(state.length !== 54) {
        alert("Cube state must be 54 characters!");
        return;
    }
    fetch("/check_state", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({state})
    })
    .then(res => res.json())
    .then(out => {
        document.getElementById("solution-output").textContent = JSON.stringify(out, null, 2);
    });
}

// random valid state
function randomState() {
    fetch("/random_state")
        .then(res => res.json())
        .then(data => {
            const state = data.state;
            document.getElementById("stateInput").value = state;
            applyCubeState(state);
            // clear history when a random state is generated
            history = []; 
            updateMoveHistoryDisplay();
        });
}

function sendMove(move) {
    const state = document.getElementById("stateInput").value.trim();

    fetch("/apply_move", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ state, move })
    })
    .then(res => res.json())
    .then(data => {
        if (data.status !== "ok") {
            alert("Move failed: " + (data.reason || "Unknown error"));
            return;
        }

        const newState = data.new_state;

        history.push(move); 
        updateMoveHistoryDisplay();

        // update UI
        document.getElementById("stateInput").value = newState;
        applyCubeState(newState);

        document.getElementById("output").textContent =
            "Applied move: " + move + "\n\n" +
            JSON.stringify(data, null, 2);
    })
    .catch(err => alert("Error: " + err));
}


// Initialize cube in solved state
applyCubeState(defaultState);

</script>

</body>
</html>
